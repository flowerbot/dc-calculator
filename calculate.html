<script src="https://cdn.jsdelivr.net/npm/promise-polyfill@8/dist/polyfill.min.js"></script>
<script src="scripts/fetch.umd.js"></script>
<script src="scripts/classListPolyFill.js"></script>
<script src="scripts/svg-inject.min.js"></script>
<script src="https://unpkg.com/papaparse@latest/papaparse.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
<script lang="javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.3/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.js"></script>
<script src="scripts/html-docx.js"></script>
<link href="scripts/intro.js-2.9.3/introjs.min.css" rel="stylesheet" />
<link href="styles/styles.css" rel="stylesheet" />
<script src="https://kit.fontawesome.com/b104c243d7.js" crossorigin="anonymous"></script>

<link rel="stylesheet"
href="https://fonts.googleapis.com/css?family=Kalam">

<!-- weird ^^ changed to non-secure, as edge was blocking it at https://fonts.googleapis.com/css?family=Kalam-->
<!--script src="https://cdnjs.cloudflare.com/ajax/libs/babel-polyfill/6.23.0/polyfill.min.js"></script> -->
<!-- ^^ was an attemp to allow MS Edge (14+) to handle 'matches' sigh .. it didn't work anyway, had to use the msMatchesSelector workaround, which did work  -->
<!-- classlistpolyfill was required for Edge (14) -->
<!-- xlsx is to turn the json export to excel (save button) -->
<!-- OPTIONAL ALERT REPLACEMENT, FIND ALERT-->
<!-- JavaScript -->
<!--script src="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/alertify.min.js"></script> -->


<!-- CSS -->
<!--link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/alertify.min.css"/-->
<!-- Default theme -->
<!--link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/default.min.css"/-->
<!-- Semantic UI theme -->
<!--link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/semantic.min.css"/0-->
<!-- Bootstrap theme -->

<!-- link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/bootstrap.min.css"/ -->

<!-- end of alertify reqs-->
<!-- start of sweet alerts2 reqs-->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
<!-- see https://sweetalert2.github.io/  -->

<!-- script src="scripts/wikiAsVariable.js"></script -->

<script src="scripts/main.js"></script>

<div id="everything">
<div class="calcLogo">
    <i class="fas fa-calculator"></i>
<h2>Infrastructure Charge Calculation</h2>
</div>
<input type='button' id='btnImport' value='import saved calc' class='dontPrint hidden' />

<input type='button' id='btnHints' value='Toggle Hints' data-state='showing' class='dontPrint' />
<input type='button' id='btnGuide' value='Show Guide' data-state='showing' class='dontPrint' />
<input type='button' id='btnComGuide' value='Show Commercial Guide' data-state='showing' class='dontPrint' />
<div>
<div class="inlineblock" id="descHelpIcon" class="hintholder" data-helpid="19"></div>
<div contenteditable=true id="calcDescription" class="calcDescription" placeholder="Enter DA/Description"></div>
</div>
<div class="wholestagecontainer">
    <div id="instructionsContainer">
        <div class="dontPrint instructions infoDiv" data-helpid="19">
        
        <img src="images/info-circle-solid.svg" class="infoImage" title="how to use this calculator">  
     
</div>


</div>
<div class="wholestage">
<div class='wrapper'>
    <div class="labelDiv" >



        <div class="stageLabel" contenteditable="true">Stage 1</div>    
        </div>
<div class="container">
<div class="Step1Selections hidden">
<h2 class="StepLabel" title="Edit to suit ..">Step 1:</h2>

    <input type="radio" name="Step1Options" value="Rural" /><label for="optRural">Rural</label><br />
    <input type="radio" name="Step1Options" value="Urban" /><label for="optUrban">Urban</label><br />
    <input type="radio" name="Step1Options" value="Urban Recalc" /><label for="optUrbanRecalc">Urban recalc</label><br />


</div>

<div class="DevTypeSelections">

    <h2 class="mainGuide StepLabel dontPrint" 

        >Choose one or more options below:</h2>
    <div class="DevTypeRow dontPrint chkResDiv">
        <div class="infoDiv" data-helpid="4">
            <i class="infoImage fas fa-info-circle"  
            onload="SVGInject(this)"></i></div>
        <label class="DevTypeCheckboxLabel">
            <input type="checkbox" name="selectDevType"  
            value="Residential" class="selectDevType devTypeSelector" />
            Residential</label>
        <div id="chkResInputs" class="DevTypeInputs chkResInputs hidden">
            <label>1br </label><input type="text" class="lotcount" data-multiplier=0.541666667 data-ets=0 value=0 />
            <label>2br </label><input type="text" class="lotcount" data-multiplier=0.708333333 data-ets=0 value=0 />
            <label>3br </label><input type="text" class="lotcount" data-multiplier=0.875 data-ets=0 value=0 />
            <label>4br+ </label><input type="text" class="lotcount" data-multiplier=1 data-ets=0 value=0 />
            <label>Trips </label><input type="text" class="trips residential txtTripsRes" data-multiplier=6.5 data-trips=0 value=0 />
            <input type="checkbox" name="multiDwelling" value="3.9" data-tripMultiplier=3.9 class="txtMultiRes chkMultiRes" />
            <label class="lblMultiRes">Multidwelling Housing</label>
            Residential ETs:<span class="spanETs spanETsRes residential" data-ets="0">0</span>


            
        </div>
    </div>
    <div class="DevTypeRow dontPrint chkSubDiv">
        <div class="infoDiv" data-helpid="5">
            <i class="infoImage fas fa-info-circle"  
            onload="SVGInject(this)"></i></div>
        <input type="checkbox" name="selectDevType" 
        value="Subdivision"  class="selectDevType devTypeSelector chkSubdivision" />
        <label for="chkSubdivision" class="DevTypeCheckboxLabel">Subdivision</label>
        <div id="chkSubInputs" class="DevTypeInputs chkSubInputs hidden">
            <label>Lots </label><input type="text" class="lotcount txtLotsSub" data-multiplier=1 value=0 />
            <label>Trips </label><input type="text" class="trips residential txtTripsSub" data-multiplier=6.5 data-trips=0 value=0 />
            <span class="spanETs spanETsSub residential hidden" data-ets="0"> ETs: 0</span>
        </div>
    </div>



    <div class="DevTypeRow dontPrint chkComDiv">
        <div class="infoDiv" data-helpid="6">
            <i class="infoImage fas fa-info-circle"  
            onload="SVGInject(this)"></i></div>
        <input type="checkbox" name="selectDevType" 
        value="Commercial"  class="selectDevType devTypeSelector chkCommercial" />
            <label class="DevTypeCheckboxLabel">Commercial</label>
        <div class="DevTypeInputs chkComInputs hidden">
            <label>GFA</label><input type="text" class="commercial txtGFACom" data-gfa=0 value=0 />
            <label>Trips</label><input type="text" class="trips commercial txtTripsCom" data-trips=0 value=0 /> 

                <input type="checkbox" name="chkEmpDiscount" class="discountCheckBox discount chkEmpDiscount" value=100><label class="discountLabel discount">Emp Discount %</label>
                <input type="text" class="discount txtEmpDiscount" data-discount="0" value=0 />
                <input type="checkbox" name="chkEBEDiscount" class="discountCheckBox discount chkEBEDiscount" value=40><label class="discountLabel discount">EBE Discount %</label>
                <input type="text" class="discount txtEBEDiscount" data-discount="0" value=0 />
                
                <label class="comLabel">ETs</label><input type="text" class="commercial txtETsCom" data-ets-com=0 placeholder="GFA converted" />

                <span class="spanETs hidden spanETsCom" data-ets="0">0</span>

        </div>
    </div>
    <div class="DevTypeRow dontPrint chkTouDiv">
        <div class="infoDiv" data-helpid="7">
            <i class="infoImage fas fa-info-circle"  
            onload="SVGInject(this)"></i></div>
        <input type="checkbox" name="selectDevType"  
        value="Tourist" class="selectDevType devTypeSelector chkTourist" />
        <label class="DevTypeCheckboxLabel">Tourist</label>
        <div class="DevTypeInputs chkTouInputs hidden">
            <label>1br </label><input type="text" class="txt1BrTou"  data-multiplier=0.541666667 data-ets=0 value=0 />
            <label>2br </label><input type="text" class="txt2BrTou" data-multiplier=0.708333333 data-ets=0 value=0 />
            <label>3br </label><input type="text" class="txt3BrTou" data-multiplier=0.875 data-ets=0 value=0 />
            <label>4br+ </label><input type="text" class="txt4BrTou" data-multiplier=1 data-ets=0  value=0 />
            <label>Trips </label><input type="text" class="trips txtTripsTou" data-multiplier=6.5 data-trips=0 value=0 />
            Tourist ETs:<span class="spanETs spanETsTou" data-ets="0">0</span>
        </div>
    </div>
    <div class="DevTypeRow dontPrint chkOthDiv">
        <div class="infoDiv" data-helpid="8">
            <i class="infoImage fas fa-info-circle"  
            onload="SVGInject(this)"></i></div>
        <input type="checkbox" name="selectDevType" value="Other"  class="devTypeSelector chkOther" />
        <label class="DevTypeCheckboxLabel">Other</label>
        <div class="DevTypeInputs chkOthInputs hidden">
         </div>
    </div>


    <div class="DevTypeRow dontPrint chkCreDiv">
        <i class="infoImage fas fa-info-circle"  
        onload="SVGInject(this)"></i></div>
        
        <input type="checkbox" name="selectDevType"  
        value="Credits" class="selectDevType devTypeSelector chkCredits" />
        <label class="DevTypeCheckboxLabel">Credits</label>
        <div class="DevTypeInputs chkCreInputs hidden">
        <label>Res/Tou ETs</label><input type="text" max=0 class="creditInput ETcredits txtETsCre"  data-ets=0 value=0 />
        
        <label>Res/Tou Trips</label><input type="text" max=0 class="trips creditInput residential TripCredits txtTripsCre"  data-multiplier=6.5 data-trips=0 value=0 />
        <label>Com GFA</label><input type="text" max=0 class="creditInput GFAcredits txtGFACre"  data-gfa=0 value=0 />
         <span class="spanETs residential hidden spanETsCre" data-row-ets="0" />
            </div>
    </div>
    <div class="DevTypeRow chkCapDiv">
        <div class="infoDiv" data-helpid="10">
            <i class="infoImage fas fa-info-circle"  
            onload="SVGInject(this)"></i></div>
        <input type="checkbox" name="DevTypeCheckboxes" 
        value="Cap" class="devTypeSelector chkCap" />

        <label class="DevTypeCheckboxLabel">Apply Cap</label>

        <div class="DevTypeInputs chkCapInputs ">
        <label for="txtCap">$</label><input type="text" class="txtCap" value=20000 />
        <span class="spanNumLots" data-numlots="0"></span><span class="spanNumLotsDesc"></span> ~
        <span class="spanNumEts" data-numets="0"></span><span class="spanNumEtsDesc"></span>
        <span class="spanOneLotCostDesc"></span><span class="spanOneLotCost" data-onelot = "0"></span>
        <span class="spanCapMultiplierDesc"></span><span class="spanCapMultiplier" data-capmultiplier = "1"></span><span>%</span>

            </div>
    </div>
</div>


    <div class="dateAndClone" data-hint="some text">
        <div class="actionRow">
        <div class="table actionTable">
            <div class="tr actionRow">
                <div class="td">
                    
                </div>
                <div class="td cp18Comm hidden">
                   CP 18 Commercial 
                </div>
                <div class="td">
                    All Residential
                </div>
                <div class="td">
                    All
                </div>
            </div>
        <div class="tr actionRow">
                <div class="td">
            Total ETs this stage: </div>
            <div class="td cp18Comm cp18CommETs hidden" contenteditable=true>
              0
             </div>
            <div class="td">
                <span contenteditable=true class="totalResEts stageResTotal">0</span>
            </div>
            <div class="td"><span contenteditable=true class="totalEts stageTotal">0</span></div>
        </div>
        <div class="tr actionRow">
            <div class="td">
            Total GFAs this stage: </div>
            <div class="td cp18Comm cp18CommGFA hidden" contenteditable=true>

               </div>
            <div class="td">
            </div>
            <div class="td"><span contenteditable=true class="totalGFA stageTotal">0</span></div>
        </div>
        <div class="tr actionRow">
            <div class="td">
                Total Trips this stage: </div>
                <div class="td cp18Comm hidden">

                   </div>
            <div class="td">
                <span contenteditable=true class="totalResTrips stageResTotal">0</span>
            </div>
            <div class="td"><span contenteditable=true class="totalTrips stageTotal">0</span></div>
</div>
<div class="tr actionRow haRow">
    <div class="td">
        Total HA this stage (estimate): </div>
        <div class="td cp18Comm hidden">
          
        </div>
<div class="td">
</div>
<div class="td"><span contenteditable=true class="totalHA stageTotal">0</span></div>
</div>
<div class="tr actionRow">
<div class="td"></div>
<div class="td cp18Comm hidden">
  
   </div>
    <div class="td">
</div>
<div class="td">
    <div class="infoDiv" data-helpid="18">
        <i class="infoImage fas fa-info-circle"  
        onload="SVGInject(this)"></i></i></div>

<input type="button" class="dontPrint btnAutofill" value="auto-fill" 
title="Click to auto-fill active levy rows with Ets/GFAs/trips from this table."/> 


</div>
</div>

        </div>


    </div>
       
        <div class="actionRow inlineblock dateSection">
            <div class="infoDiv" data-helpid="16">
                <i class="infoImage fas fa-info-circle"  
                onload="SVGInject(this)"></i></div>
            <label>Calculation date:</label><input type="date" class="txtDate" value="" placeholder="dd/mm/yyyy" 
            />
            <div class="inlineblock">
            <div class="infoDiv" data-helpid="17">
                <i class="infoImage fas fa-info-circle"  
                onload="SVGInject(this)"></i></div>
            <label>Effective date:</label><input readonly="readonly" type="date" class="txtEffectiveDate" value="" placeholder="dd/mm/yyyy" 
            />
            </div>
        </div>
        <div class="actionRow">
            <div class="infoDiv" data-helpid="11">
                <i class="infoImage fas fa-info-circle"  
                onload="SVGInject(this)"></i></div>
            <input type="button" class="dontPrint chkClone" value="Duplicate Stage"/>
        </div>
    </div>

</div>

<h2 
class="dontPrint availablePlansHeading">Available plans:</h2>
<div class="dontPrint planControls">
 
    <div class="infoDiv" data-helpid="11">
        <i class="infoImage fas fa-info-circle"  
        onload="SVGInject(this)"></i></div>
    <input type="checkbox" class="chkZeros" /><span class="spanZeros">hide 0's</span>  

    <div class="infoDiv" data-helpid="12">
        <i class="infoImage fas fa-info-circle"  
        onload="SVGInject(this)"></i></div>

    <input type="checkbox" class="chkActive" /><span class="spanActive">hide inactive</span> 

    <div class="infoDiv" data-helpid="13">
        <i class="infoImage fas fa-info-circle"  
        onload="SVGInject(this)"></i></div>
    <input type="checkbox" class="chkExtras" /><span class="spanExtras">show extras</span> 

    <div class="infoDiv" data-helpid="14">   
        <i class="infoImage fas fa-info-circle"  
        onload="SVGInject(this)"></i></div>
    <input type="checkbox" class="chkCP04Levy" /><span class="spanCP04Levy">toggle CP04 Sectors</span> 

    <input type="button" class="dontPrint btnReZero" value="reset to zero" title="click to set inputs back to zero"/> 

    <div class="infoDiv" data-helpid="20">
        <i class="infoImage fas fa-info-circle"  
        onload="SVGInject(this)"></i></div>
    <input type="button" class="btnCalculate dontPrint" name="btnCalculate" value="CALCULATE!" /> 
      


</div>

</div>
<div class="planContainer table" id="planContainer"

>


</div>
<hr class="stageDivider" />
</div>

<table id="mainFooterTable" class="dontPrint"></table>
<div id="floatableNotes" class="hidden dontPrint">
    <div id="floatableTop">
    <div id="closeFloatable">X</div>
    NOTE!
</div>
    <ol>
    <li id="fnCP18" class="hidden">
        The Commercial GFA entered has been converted to ET for inputting into CI, because CI is set up to only receive ETs for CP18 - you must click CALCULATE! again to calculate totals pertaining to the new ET figure.
    </li>
    <li id="fnCAP" class="hidden">
        The calculated contribution per residential ET exceeds the selected CAP ($<span id="fnCAPcap" class="fnCAPcap"></span>) - you must click the CALCULATE! button a second time to apply the calculated cap reduction (<span id="fnCAPreduction"></span>). 
    </li>
    <li id="fnCP28" class="hidden">
        This calculation includes CP 28.  CP 28 contributions are not affected by the CAP. 
    </li>
    <li id="fnManualEntry" class="hidden">
        The figures you enter manually are copied to the 'residential value' (Res) column and used to work out whether the contributions cap applies - please adjust the value in the Res column manually if you need to<span class="fnCP18 hidden"> <strong> (take special care with CP18 if it contains both residential and commercial elements)</strong></span>.  <br />Click the 'Apply Cap' checkbox to view the 'Res' column if it isn't already visible. 
    </li>
    </ol>
</div> 
</div>
<div id="mainFooter"><input type="button" class='dontPrint' id="btnSave" value="Save to Excel" />
    <input type="button" class='dontPrint' id="btnSaveWord" value="Save to Word" /> 
    <input type="checkbox" class="dontPrint chkSaveSP hidden" id="chkSaveSP" checked="checked" /> <span class="dontPrint hidden">Save to SP ~ </span>
    <div id="versionNum" class="inlineblock"></div><div id="datadate" class="inlineblock"></div><div id="preparedByDiv" class="hidden">Prepared by: <span id="preparedBy"></span></div></div>
<div id="wordOutput" class="hidden"></div>
<script src="scripts/intro.js-2.9.3/intro.min.js"></script>